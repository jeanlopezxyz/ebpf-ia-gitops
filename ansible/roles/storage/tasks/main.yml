---
- name: Enable storage addon for Minikube
  command: minikube addons enable storage-provisioner --profile {{ minikube.profile }}
  ignore_errors: yes

- name: Create enhanced StorageClass for persistent data  
  kubernetes.core.k8s:
    definition:
      apiVersion: storage.k8s.io/v1
      kind: StorageClass
      metadata:
        name: persistent-storage
        annotations:
          storageclass.kubernetes.io/is-default-class: "false"
      provisioner: k8s.io/minikube-hostpath
      volumeBindingMode: Immediate
      reclaimPolicy: Retain
      allowVolumeExpansion: true
      parameters:
        type: hostPath
    state: present

- name: Display storage setup results
  debug:
    msg:
      - "âœ… Storage configuration completed!"
      - "ðŸ“¦ StorageClass: persistent-storage (hostPath, retain policy)"
      - "ðŸ”§ Provisioner: k8s.io/minikube-hostpath"
